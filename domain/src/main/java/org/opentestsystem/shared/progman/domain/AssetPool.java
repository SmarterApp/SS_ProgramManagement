/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/
package org.opentestsystem.shared.progman.domain;

import java.util.List;

import org.hibernate.validator.constraints.NotBlank;
import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.index.CompoundIndex;
import org.springframework.data.mongodb.core.index.CompoundIndexes;
import org.springframework.data.mongodb.core.mapping.Document;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.google.common.collect.Lists;

@Document
@JsonIgnoreProperties(ignoreUnknown = true)
@CompoundIndexes(value = {@CompoundIndex(name = "tenantPoolName", def = "{'tenantId':1, 'name':1}", unique = true) })
public class AssetPool {

    @Id
    private String id;

    @NotBlank(message = "assetPool.tenant.required")
    private String tenantId;

    @NotBlank(message = "assetPool.name.required")
    private String name;

    private List<Asset> assets;

    private static final String GET_RESOURCE_NAME = "/assetPool/";

    /**
     * @return the id
     */
    public String getId() {
        return id;
    }

    /**
     * @param inId the id to set
     */
    public void setId(final String inId) {
        id = inId;
    }

    /**
     * @return the tenantId
     */
    public String getTenantId() {
        return tenantId;
    }

    /**
     * @param inTenantId the tenantId to set
     */
    public void setTenantId(final String inTenantId) {
        tenantId = inTenantId;
    }

    /**
     * @return the name
     */
    public String getName() {
        return name;
    }

    /**
     * @param name the name to set
     */
    public void setName(final String inName) {
        this.name = inName;
    }

    /**
     * @return the assets
     */
    public List<Asset> getAssets() {
        return assets;
    }

    /**
     * @param assets the assets to set
     */
    public void setAssets(final List<Asset> assetlist) {
        this.assets = assetlist;
    }

    public void addAsset(final Asset assetToAdd) {
        if (this.assets == null) {
            this.assets = Lists.newArrayList();
        }
        this.assets.add(assetToAdd);
    }

    public void deleteAssetByGridId(final String fileGridId) {
        Asset deleteAsset = null;
        if (this.assets != null) {
            for (Asset asset : this.assets) {
                if (asset.getAssetFileGridId().equals(fileGridId)) {
                    deleteAsset = asset;
                    break;
                }
            }
            this.assets.remove(deleteAsset);
        }
    }

    @JsonProperty
    public String getUrl() {
        return GET_RESOURCE_NAME + this.id;
    }

}
